## How do I start my app? What do I do now?

The easiest way to start an app is to see if there is an existing app that is similar to it, or has a UI that you would like to use and to look at the way it is created. Every app you see in the narrative will have a link to its code repository.

The logical order to start working on the app begins with 

### 1) Working on the YourAppName.spec file. This will autogenerate methods in your .impl file, which is where the core of your method functionality will reside.

It is recommended to have a spec file look the following:
    (SpecFile Recipes Link)
    

Run Make and this will autogenerate the implementation file.

    
### 2) Working on the functionality of the app in the autogenerated .impl file. 

Each method will get two basic components as its input
* Params
    * The params will either not exist or be blank depending on default values defined in the spec file
    * The params will likely contain one or more object reference strings that allow you to retrieve the object ("WorkspaceID/ObjectID/Version")
* Context
    * The context will be used to store token and provenance. 
    * You don't need to use this except for X 
        

The most commonly used input from the UI that might be hard to emulate at first is the Object Reference. But if the spec file has the target_type_transform, you will get an Object Reference in the form of something like "WorkspaceID/ObjectID/Version"

    "input_parameter": "object_ref",
    "target_property": "object_ref",
    "target_type_transform": "ref"
    
#### How do I organize the code?

There are two common patterns:
1) Create multiple functions and do everything inside the implmentation file. An example of this pattern can be found in these apps [1,2,3]()
2) Create a utils directory, create a runner or utility class, pass in the configuration file and parameter files to it, and do everything in there. An example of this pattern can be found in these apps [1,2,3]()
3) Put data into the data directory. If the data is too large to host on github, check out the following guide for [how to add reference data](https://github.com/kbase/kb_sdk/blob/master/doc/kb_sdk_refdata.md)


### 3) Continue developing the app by working on unit tests
The following modules show some good examples of tests in which objects are either taken from an existing reference, or uploaded from a local file into the workspace and then retreiving the object reference for it. [1,2,3]()
Put test related data into the data folder inside the test directory. 



### 4) Make the UI
* hook up the UI to the Spec File to the parameters you are expecting inside your app


# Common Questions

### Help! My python code in the implementation file keeps disappearing? What happened to it?
Magic comments are comments that are used internally by the kbase_sdk in order to generate the implementation file when you make changes to the spec file. 

Examples of magic comments include
```
#BEGIN_HEADER
(This is where your import statements go)
#END_HEADER

#BEGIN_CLASS_HEADER
(This is where your class variables and functions go that you want imported)
#END_CLASS_HEADER

#BEGIN_CONSTRUCTOR
(This is in your init statement for your class goes)
#END_CONSTRUCTOR

#BEGIN YourFunctionName1
(This is were the implementation details of your functions go)
#END YourFunctionName1
```
Any code created outside of the Magic Comments will not be included inside the final .impl implementation file.

# Validation
### Q: How does validation work for apps? 

Currently validation is done in the UI based on values provided in the ui/narrative/methods/spec.json. 
When invalid input is entered in the UI for the app, an error will display to the user,
and the user will not be able to submit the form for the app.

Validation is not provided for the app to be called programmatically (such as with unit tests)
so you will have to validate your input again. 
It may be possible to generate validation programmatically using the spec.json file,
but this is not currently an out of the box feature.

### Q: How do I learn more about the spec.json file?
While there isn't a document with all of the valid UI Parameters, 
you can check out this notebook with a variety of different options at
[User Inferface Parameter Gallery](https://narrative.kbase.us/narrative/ws.23109.obj.1). Also see [Narrative UI Specification](https://github.com/kbase/kb_sdk/blob/master/doc/NarrativeUIAppSpecification.pdf)

### Q: What are all the auto-generated source files in my app?

These files are created by the KBase type compiler, which takes your KIDL type file (`MyModule.spec`) and generates different modules that are inserted into your codebase. These files are used by docker and service handlers to run your app and its dependencies.

In python apps, the `authclient.py` and `baseclient.py` files get placed into the package directory for your own app, as well as all other the package directories. These files are generally the same across all the packages in your app. `authclient.py` handles authenticating the user so they can access the workspace, while `baseclient.py` has functionality for running SDK apps and calling their methods.

Other auto-generated files in python apps include the `*Client.py` and `*Server.py` files in each package. Each app has an `AppNameClient.py` module in its package. These modules contain classes that can receive parameters for the app and pass that data to the app's server

The `MyModuleServer.py` file gets auto-generated and saved only for your own app's package directory. It handles requests from the python client code

### Q: What makes the tests slow to run?

Every time we run `kb-sdk test` it rebuilds the docker container and re-downloads data objects from your workspace.

Ways you can speed up your tests:

* Make sure all your custom docker setup, such as compiling binaries, is at the top of your Dockerfile so it always gets cached
* Reduce the amount of files you download and upload 
* Reuse existing example files on the workspace so you don't have to upload files
* Separate out your modules into functions that just take local data and files, and test those separately
* Create a separate unit tests that you can run directly, bypassing `kb-sdk test`

### Q: When you install and run SDK Apps from within your own app, how are these running?

SDK app dependencies that you use in your own app, such as `DataFileUtil`, run in their own docker containers using their own separate servers

TODO someone with more knowledge of how this works should flesh this out (-jay)

# Docker

### Q: Should I always specify a specific version of a library or executable ?

There is not currently a requirement to use a specific version, but the tradeoff is as follows:
When using a specific version of a library or executable, you don't have to worry as much about backwards comptability with future releases.
However, if a newer version of the software is available, your app won't automatically use it. 

### Q: Where do I install binaries in docker?

You can install binaries that will automatically be added to $PATH at /kb/deployment/bin, like so

    #Install Diamond Binary v0.9.17
    WORKDIR /kb/deployment/bin
    RUN wget https://github.com/bbuchfink/diamond/releases/download/v0.9.17/diamond-linux64.tar.gz \
    && tar -xvf diamond-linux64.tar.gz diamond \
    && rm diamond-linux64.tar.gz
  
Please follow the [edit dockerfile](https://github.com/kbase/kb_sdk/blob/master/doc/kb_sdk_local_test_module.md#a-edit-dockerfile)
section of the kb-sdk guide.

### Q: How do I get inside the docker image? How do I get root access?

You are supposed to be able to be logged in with sudo access when you run the test_local/run_bash.sh script. If thatâ€™s not working, try changing the --user parameter to `--user 0`

### Q: Tell me about the .sh scripts in the test_local directory?
You don't really need anything besides the run_bash.sh script. If you want to run tests, use `kb-sdk test`

### Q: How do I have multiple docker images for different versions of my app or dynamic service?
You will need to `docker build ` them and tag them with different names if this is not automatically done by your app.

# Common Errors

Help, my report isn't generating output correctly! (Make sure you are using the correct widget, the workspace name is wsName and the output being returned is an array of the dictionary)

`ServerError: JSONRPCError: -32601. Unknown server error (output data wasn't produced)`
This case happens because the python process exits without writing an output file, and then the call back server throws the error above

Error while testing module: Login failed! Server responded with code 401 Unauthorized
Your token has expired. Get another one by opening your notebook and running
    
    import os
    os.environ
